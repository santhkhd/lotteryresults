<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Search Tickets</title>
    <link rel="manifest" href="manifest.json">
    <link href="output.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 min-h-screen pb-24 selection:bg-blue-500 selection:text-white">

    <!-- Header -->
    <header class="fixed top-0 w-full z-40 glass border-b border-gray-100 transition-all duration-300">
        <div class="px-5 h-16 flex items-center justify-between max-w-2xl mx-auto">
            <div class="flex items-center gap-3">
                <button onclick="goBack()"
                    class="p-2 -ml-2 rounded-full hover:bg-gray-100 active:scale-95 transition-all text-gray-600">
                    <span class="material-icons-round text-2xl">arrow_back</span>
                </button>
                <h1 class="text-xl font-bold text-gray-800" id="header-title">Search</h1>
            </div>

            <div class="flex items-center gap-2">
                <button id="langIconBtn"
                    class="p-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 active:scale-95 transition-all">
                    <span class="material-icons-round text-xl">translate</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Language Popup -->
    <div id="langPopup"
        class="hidden fixed inset-0 z-[60] flex items-end sm:items-center justify-center bg-black/40 backdrop-blur-sm transition-opacity">
        <div class="bg-white w-full sm:w-80 rounded-t-2xl sm:rounded-2xl p-6 shadow-2xl transform transition-transform">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-gray-800">Choose Language</h3>
                <button class="p-2 bg-gray-100 rounded-full active:bg-gray-200 transition-colors"
                    onclick="document.getElementById('langPopup').classList.add('hidden')">
                    <span class="material-icons-round text-gray-500">close</span>
                </button>
            </div>
            <div class="space-y-3">
                <button
                    class="lang-popup-btn w-full flex items-center justify-between p-4 rounded-xl border border-gray-100 hover:border-blue-500 hover:bg-blue-50 active:bg-blue-100 transition-all font-medium"
                    data-lang="en">
                    <span>English</span>
                    <span class="text-xl">üá∫üá∏</span>
                </button>
                <button
                    class="lang-popup-btn w-full flex items-center justify-between p-4 rounded-xl border border-gray-100 hover:border-blue-500 hover:bg-blue-50 active:bg-blue-100 transition-all font-medium"
                    data-lang="ml">
                    <span>‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</span>
                    <span class="text-xl">üáÆüá≥</span>
                </button>
                <button
                    class="lang-popup-btn w-full flex items-center justify-between p-4 rounded-xl border border-gray-100 hover:border-blue-500 hover:bg-blue-50 active:bg-blue-100 transition-all font-medium"
                    data-lang="ta">
                    <span>‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</span>
                    <span class="text-xl">üáÆüá≥</span>
                </button>
            </div>
        </div>
    </div>

    <main class="pt-24 px-5 max-w-2xl mx-auto min-h-screen">

        <div class="text-center mb-8">
            <div class="inline-block p-4 rounded-full bg-blue-50 text-blue-600 mb-4">
                <span class="material-icons-round text-4xl">search</span>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 mb-2" id="searchTitle">Check Your Ticket</h2>
            <p class="text-gray-500 text-sm max-w-xs mx-auto" id="searchDesc">Enter your ticket number and select a date
                to see if you won.</p>
        </div>

        <form class="w-full flex flex-col gap-4 bg-white p-6 rounded-3xl shadow-sm border border-gray-100"
            onsubmit="event.preventDefault();searchNumber();">
            <!-- Number Input -->
            <div>
                <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2"
                    id="labelNumber">Ticket Number</label>
                <input type="text" id="numberSearchInput" placeholder="e.g. AA 123456" maxlength="20"
                    class="w-full bg-gray-50 border border-gray-200 text-gray-900 text-lg font-mono rounded-xl px-4 py-4 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all placeholder-gray-400">
            </div>

            <!-- Date Input -->
            <div>
                <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2" id="labelDate">Draw
                    Date</label>
                <div class="relative">
                    <input type="date" id="dateSearchInput"
                        class="w-full bg-gray-50 border border-gray-200 text-gray-900 text-lg rounded-xl px-4 py-4 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all appearance-none">
                    <button type="button" id="clearDateBtn"
                        class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-red-500 hidden">
                        <span class="material-icons-round">cancel</span>
                    </button>
                </div>
            </div>

            <!-- Buttons -->
            <div class="grid grid-cols-2 gap-3 mt-2">
                <button type="button"
                    class="bg-gray-100 text-gray-600 font-bold py-4 rounded-xl active:scale-95 transition-all flex items-center justify-center gap-2"
                    onclick="clearNumberSearch()">
                    Clean
                </button>
                <button type="submit" id="searchBtn" disabled
                    class="bg-blue-600 disabled:bg-gray-300 disabled:text-gray-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-200 active:scale-95 transition-all flex items-center justify-center gap-2">
                    Check Now
                </button>
            </div>
        </form>

        <div id="numberSearchResults" class="w-full mt-8 space-y-4"></div>

    </main>

    <nav
        class="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-md border-t border-gray-200 pb-safe z-40 shadow-[0_-4px_20px_rgba(0,0,0,0.02)]">
        <div class="flex justify-around items-center h-16 max-w-2xl mx-auto">
            <a href="index.html"
                class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-blue-500 transition-colors">
                <span class="material-icons-round text-2xl mb-0.5">home</span>
                <span class="text-[10px] font-medium">Home</span>
            </a>
            <a href="prediction.html"
                class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-blue-500 transition-colors">
                <span class="material-icons-round text-2xl mb-0.5">auto_awesome</span>
                <span class="text-[10px] font-medium">Lucky</span>
            </a>
            <a href="search.html"
                class="flex flex-col items-center justify-center w-full h-full text-blue-600 relative">
                <div class="absolute -top-1 w-8 h-1 bg-blue-600 rounded-b-full"></div>
                <span class="material-icons-round text-2xl mb-0.5 animate-bounce-short">search</span>
                <span class="text-[10px] font-bold">Search</span>
            </a>
            <a href="scanner.html"
                class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-blue-500 transition-colors">
                <span class="material-icons-round text-2xl mb-0.5">qr_code_scanner</span>
                <span class="text-[10px] font-medium">Scan</span>
            </a>
            <a href="live.html"
                class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-blue-500 transition-colors">
                <span class="material-icons-round text-2xl mb-0.5 text-rose-500">live_tv</span>
                <span class="text-[10px] font-medium text-rose-500">Live</span>
            </a>
        </div>
    </nav>

    <script>
        // Existing Logic structure adapted
        const uiStrings = {
            en: {
                header: 'Search',
                searchTitle: 'Check Your Ticket',
                searchDesc: "Enter your ticket number and select a date to see if you won.",
                labelNumber: 'Ticket Number',
                labelDate: 'Draw Date',
                check: 'Check Now',
                clear: 'Clean',
                noResult: 'No result found for this date.',
                notFound: num => `Ticket <span class="font-mono font-bold">${num}</span> did not win any prize on this date.`,
                winner: n => `Congratulations! Found ${n} Winning Entr${n > 1 ? 'ies' : 'y'}`,
                viewResult: 'View Full Result'
            },
            ml: {
                header: '‡¥§‡¥ø‡¥∞‡¥Ø‡µÅ‡¥ï',
                searchTitle: '‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï',
                searchDesc: "‡¥®‡¥Æ‡µç‡¥™‡¥±‡µÅ‡¥Ç ‡¥§‡µÄ‡¥Ø‡¥§‡¥ø‡¥Ø‡µÅ‡¥Ç ‡¥®‡µΩ‡¥ï‡¥ø ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ø‡¥ö‡µç‡¥ö‡µã ‡¥é‡¥®‡µç‡¥®‡µç ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.",
                labelNumber: '‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç ‡¥®‡¥Æ‡µç‡¥™‡µº',
                labelDate: '‡¥®‡¥±‡µÅ‡¥ï‡µç‡¥ï‡µÜ‡¥ü‡µÅ‡¥™‡µç‡¥™‡µç ‡¥§‡µÄ‡¥Ø‡¥§‡¥ø',
                check: '‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï',
                clear: '‡¥Æ‡¥æ‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥ï',
                noResult: '‡¥à ‡¥§‡µÄ‡¥Ø‡¥§‡¥ø‡¥Ø‡¥ø‡µΩ ‡¥´‡¥≤‡¥Ç ‡¥≤‡¥≠‡µç‡¥Ø‡¥Æ‡¥≤‡µç‡¥≤.',
                notFound: num => `‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç <span class="font-mono font-bold">${num}</span> ‡¥à ‡¥§‡µÄ‡¥Ø‡¥§‡¥ø‡¥Ø‡¥ø‡µΩ ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ø‡¥ö‡µç‡¥ö‡¥ø‡¥≤‡µç‡¥≤.`,
                winner: n => `‡¥Ö‡¥≠‡¥ø‡¥®‡¥®‡µç‡¥¶‡¥®‡¥ô‡µç‡¥ô‡µæ! ${n} ‡¥∏‡¥Æ‡µç‡¥Æ‡¥æ‡¥®‡¥ô‡µç‡¥ô‡µæ ‡¥≤‡¥≠‡¥ø‡¥ö‡µç‡¥ö‡µÅ`,
                viewResult: '‡¥´‡¥≤‡¥Ç ‡¥ï‡¥æ‡¥£‡µÅ‡¥ï'
            },
            ta: {
                header: '‡Æ§‡Øá‡Æü‡ØÅ',
                searchTitle: '‡Æü‡Æø‡Æï‡Øç‡Æï‡ØÜ‡Æü‡Øç ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç',
                searchDesc: "‡Æü‡Æø‡Æï‡Øç‡Æï‡ØÜ‡Æü‡Øç ‡Æé‡Æ£‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øá‡Æ§‡Æø‡ÆØ‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Øç‡Æü‡ØÅ ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
                labelNumber: '‡Æü‡Æø‡Æï‡Øç‡Æï‡ØÜ‡Æü‡Øç ‡Æé‡Æ£‡Øç',
                labelDate: '‡Æï‡ØÅ‡Æ≤‡ØÅ‡Æï‡Øç‡Æï‡Æ≤‡Øç ‡Æ§‡Øá‡Æ§‡Æø',
                check: '‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç',
                clear: '‡ÆÖ‡Æ¥‡Æø',
                noResult: '‡Æá‡Æ®‡Øç‡Æ§ ‡Æ§‡Øá‡Æ§‡Æø‡ÆØ‡Æø‡Æ≤‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡ØÅ ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà.',
                notFound: num => `‡Æü‡Æø‡Æï‡Øç‡Æï‡ØÜ‡Æü‡Øç <span class="font-mono font-bold">${num}</span> ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æ™‡ØÜ‡Æ±‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.`,
                winner: n => `‡Æµ‡Ææ‡Æ¥‡Øç‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Øç‡Æï‡Æ≥‡Øç! ${n} ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø`,
                viewResult: '‡ÆÆ‡ØÅ‡Æ¥‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡ØÅ'
            }
        };

        let currentLang = localStorage.getItem('lang') || 'en';

        // UI Elements
        const numberInput = document.getElementById('numberSearchInput');
        const dateInput = document.getElementById('dateSearchInput');
        const searchBtn = document.getElementById('searchBtn');
        const clearDateBtn = document.getElementById('clearDateBtn');
        const resultsContainer = document.getElementById('numberSearchResults');

        // Language Handling
        function setLang(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            const ui = uiStrings[lang];

            document.getElementById('header-title').textContent = ui.header;
            document.getElementById('searchTitle').textContent = ui.searchTitle;
            document.getElementById('searchDesc').textContent = ui.searchDesc;
            document.getElementById('labelNumber').textContent = ui.labelNumber;
            document.getElementById('labelDate').textContent = ui.labelDate;
            searchBtn.textContent = ui.check;

            // Update popups buttons style
            document.querySelectorAll('.lang-popup-btn').forEach(btn => {
                if (btn.dataset.lang === lang) btn.classList.add('bg-blue-50', 'border-blue-500');
                else btn.classList.remove('bg-blue-50', 'border-blue-500');
            });
        }

        // Popup Logic
        const langIconBtn = document.getElementById('langIconBtn');
        const langPopup = document.getElementById('langPopup');

        langIconBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            langPopup.classList.remove('hidden');
        });

        document.body.addEventListener('click', (e) => {
            if (!langPopup.contains(e.target) && !langIconBtn.contains(e.target)) {
                langPopup.classList.add('hidden');
            }
        });

        document.querySelectorAll('.lang-popup-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                setLang(btn.dataset.lang);
                langPopup.classList.add('hidden');
            });
        });

        // Back nav
        function goBack() {
            window.history.length > 1 ? window.history.back() : window.location.href = 'index.html';
        }

        // Search Logic
        let historyData = [];
        // Try to load history data
        fetch('history.json').then(r => r.json()).then(d => historyData = d).catch(e => console.warn('Local history not found, trying remote', e));

        // Fallback to remote if local fails (simulated by timeout or just parallel? simple retry)
        // Actually simplicity is key. If history.json exists locally (which it does), use it.

        function updateSearchBtnState() {
            searchBtn.disabled = !(numberInput.value.trim() && dateInput.value);
            clearDateBtn.classList.toggle('hidden', !dateInput.value);
        }

        numberInput.addEventListener('input', updateSearchBtnState);
        dateInput.addEventListener('input', updateSearchBtnState);

        clearDateBtn.addEventListener('click', () => {
            dateInput.value = '';
            updateSearchBtnState();
        });

        function clearNumberSearch() {
            numberInput.value = '';
            dateInput.value = '';
            resultsContainer.innerHTML = '';
            updateSearchBtnState();
        }

        function searchNumber() {
            const num = numberInput.value.trim();
            const date = dateInput.value;
            const ui = uiStrings[currentLang];

            if (!num || !date) return;

            // Find result
            const result = historyData.find(r => r.date === date);

            if (!result) {
                resultsContainer.innerHTML = `
                <div class="bg-white rounded-2xl p-6 text-center shadow-sm border border-gray-100">
                    <div class="bg-red-50 text-red-500 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                         <span class="material-icons-round">sentiment_dissatisfied</span>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-2">No Draw Found</h3>
                    <p class="text-sm text-gray-500">${ui.noResult}</p>
                </div>
            `;
                return;
            }

            // Check number
            const searchLower = num.replace(/\s+/g, '').toLowerCase();
            let winningPrizes = [];

            (result.prizes || []).forEach(prize => {
                (prize.winners || []).forEach(w => {
                    const wClean = w.replace(/\s+/g, '').toLowerCase();
                    // Matches: exact, series+num, etc (simplified logic from previous)
                    let isMatch = wClean.includes(searchLower);
                    // Implement more strict matching if needed, but for now strict inclusion or start
                    // Using the previous logic for better accuracy:
                    const searchIsLong = searchLower.length > 4;
                    if (wClean === searchLower) isMatch = true;
                    else if (searchIsLong && wClean.startsWith(searchLower)) isMatch = true;
                    else if (wClean.endsWith(searchLower) && searchLower.length >= 4) isMatch = true;

                    if (isMatch) {
                        winningPrizes.push({ prize: prize.label, amount: prize.amount, match: w });
                    }
                });
            });

            if (winningPrizes.length > 0) {
                resultsContainer.innerHTML = `
               <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-3xl p-6 text-white text-center shadow-lg transform transition-all hover:scale-[1.02]">
                    <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm">
                         <span class="text-4xl">üéâ</span>
                    </div>
                    <h3 class="text-2xl font-bold mb-1">${ui.winner(winningPrizes.length)}</h3>
                    <p class="opacity-90 text-sm mb-6">Draw Date: ${result.date}</p>
                    
                    <div class="space-y-3">
                        ${winningPrizes.map(p => `
                            <div class="bg-white/10 rounded-xl p-3 border border-white/20 backdrop-blur-sm">
                                <div class="font-bold text-yellow-300 text-lg">${p.prize}</div>
                                <div class="text-sm font-mono opacity-80 mt-1">Ticket: ${p.match}</div>
                                <div class="text-xl font-bold mt-1">‚Çπ${p.amount ? parseInt(p.amount).toLocaleString() : ''}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <a href="result.html?file=${result.filename}" class="mt-6 inline-block bg-white text-green-600 font-bold py-3 px-8 rounded-xl shadow-lg active:scale-95 transition-all">
                        ${ui.viewResult}
                    </a>
               </div>
            `;
            } else {
                resultsContainer.innerHTML = `
                <div class="bg-white rounded-2xl p-6 text-center shadow-sm border border-gray-100">
                    <div class="bg-gray-100 text-gray-400 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                         <span class="material-icons-round text-3xl">close</span>
                    </div>
                    <p class="text-gray-600 mb-6">${ui.notFound(num)}</p>
                    
                     <a href="result.html?file=${result.filename}" class="inline-block bg-gray-900 text-white font-bold py-3 px-6 rounded-xl shadow active:scale-95 transition-all text-sm">
                        Check Full Results
                    </a>
                </div>
            `;
            }
        }

        // Init
        setLang(currentLang);
    </script>
</body>

</html>